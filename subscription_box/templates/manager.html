{% extends 'base.html' %}

{% block meta %}
<title>Subscription Box Manager</title>
{% endblock meta %}

{% block content %}
<dh-component>
    <div class="py-12 transition duration-150 ease-in-out z-10 absolute top-0 right-0 bottom-0 left-0 backdrop-blur-md" id="modal" aria-hidden="true" hidden>
        <div role="alert" class="container mx-auto w-11/12 md:w-2/3 max-w-lg">
            <div class="relative py-8 px-5 md:px-10 bg-white shadow-md rounded border border-gray-400">
                <div class="w-full flex justify-start text-gray-600 mb-3">
                    <svg  xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-wallet" width="52" height="52" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" />
                        <path d="M17 8v-3a1 1 0 0 0 -1 -1h-10a2 2 0 0 0 0 4h12a1 1 0 0 1 1 1v3m0 4v3a1 1 0 0 1 -1 1h-12a2 2 0 0 1 -2 -2v-12" />
                        <path d="M20 12v4h-4a2 2 0 0 1 0 -4h4" />
                    </svg>
                    <h1 class="text-gray-800 font-lg font-bold tracking-normal leading-tight mb-4">Request a Book</h1>
                </div>

                <form method="post" id="request-form-1" class="space-y-4">
                    {% csrf_token %}
                    <div class="flex items center justify-start w-full space-x-4">
                        <label for="name" class="text-gray-600">Name</label>
                        <input type="text" name="name" id="name" class="border border-gray-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#AA3855] transition duration-150 ease-in-out w-full" required>
                        <label for="price" class="text-gray-600">Price</label>
                        <input type="number" name="price" id="price" class="border border-gray-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#AA3855] transition duration-150 ease-in-out w-full" required>
                        <label for="type" class="text-gray-600">Type</label>
                        <input type="radio" name="type" id="qtr" value="QTR">
                        <label for="qtr">QTR</label>
                        <input type="radio" name="type" id="mth" value="MTH">
                        <label for="mth">MTH</label>
                        <input type="radio" name="type" id="saa" value="SAA">
                        <label for="saa">SAA</label>
                    </div>

                    <div class="flex items-center justify-start w-full">
                        <button class="focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#AA3855] transition duration-150 ease-in-out hover:bg-[#AA3855] bg-[#C44B6A] rounded text-white px-8 py-2 text-sm" onclick="createSubscription()">Submit</button>
                        <button class="focus:outline-none focus:ring-2 focus:ring-offset-2  focus:ring-gray-400 ml-3 bg-gray-100 transition duration-150 text-gray-600 ease-in-out hover:border-gray-400 hover:bg-gray-300 border rounded px-8 py-2 text-sm" onclick="modalHandler()">Cancel</button>
                    </div>
                </form>
                <button class="cursor-pointer absolute top-0 right-0 mt-4 mr-5 text-gray-400 hover:text-gray-600 transition duration-150 ease-in-out rounded focus:ring-2 focus:outline-none focus:ring-gray-600" onclick="modalHandler()" aria-label="close modal" role="button">
                    <svg  xmlns="http://www.w3.org/2000/svg"  class="icon icon-tabler icon-tabler-x" width="20" height="20" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" />
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
</dh-component>
<dh-component>
    <div class="py-12 transition duration-150 ease-in-out z-10 absolute top-0 right-0 bottom-0 left-0 backdrop-blur-md" id="modal" aria-hidden="true" hidden>
        <div role="alert" class="container mx-auto w-11/12 md:w-2/3 max-w-lg">
            <div class="relative py-8 px-5 md:px-10 bg-white shadow-md rounded border border-gray-400">
                <div class="w-full flex justify-start text-gray-600 mb-3">
                    <svg  xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-wallet" width="52" height="52" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" />
                        <path d="M17 8v-3a1 1 0 0 0 -1 -1h-10a2 2 0 0 0 0 4h12a1 1 0 0 1 1 1v3m0 4v3a1 1 0 0 1 -1 1h-12a2 2 0 0 1 -2 -2v-12" />
                        <path d="M20 12v4h-4a2 2 0 0 1 0 -4h4" />
                    </svg>
                    <h1 class="text-gray-800 font-lg font-bold tracking-normal leading-tight mb-4">Request a Book</h1>
                </div>

                <form method="post" id="request-form-2" class="space-y-4">
                    {% csrf_token %}
                    <label for="name">Name</label>
                    <input type="text" name="name" id="name" class="border border-gray-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#AA3855] transition duration-150 ease-in-out w-full" required>
                    <label for="quantity">Quantity</label>
                    <input type="number" name="quantity" id="quantity" class="border border-gray-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#AA3855] transition duration-150 ease-in-out w-full" required>
                    

                    <div class="flex items-center justify-start w-full">
                        <button class="focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#AA3855] transition duration-150 ease-in-out hover:bg-[#AA3855] bg-[#C44B6A] rounded text-white px-8 py-2 text-sm" onclick="createItem()">Submit</button>
                        <button class="focus:outline-none focus:ring-2 focus:ring-offset-2  focus:ring-gray-400 ml-3 bg-gray-100 transition duration-150 text-gray-600 ease-in-out hover:border-gray-400 hover:bg-gray-300 border rounded px-8 py-2 text-sm" onclick="modalHandler()">Cancel</button>
                    </div>
                </form>
                <button class="cursor-pointer absolute top-0 right-0 mt-4 mr-5 text-gray-400 hover:text-gray-600 transition duration-150 ease-in-out rounded focus:ring-2 focus:outline-none focus:ring-gray-600" onclick="modalHandler()" aria-label="close modal" role="button">
                    <svg  xmlns="http://www.w3.org/2000/svg"  class="icon icon-tabler icon-tabler-x" width="20" height="20" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" />
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
</dh-component>
<h1>Subscription Box Manager</h1>
<table>
    <thead>
        <tr>
            <th>Subscription Box</th>
            <th>Price</th>
            <th>Type</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for subscription_box in subscription_boxes %}
        <tr>
            <td>{{ subscription_box.name }}</td>
            <td>{{ subscription_box.price }}</td>
            <td>{{ subscription_box. }}</td>
            <td>
                <a href="{% url 'subscription_box:get_subscription' subscription_box.id %}">Edit</a>
                <a href="{% url 'subscription_box:delete' subscription_box.id %}">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<button onclick=modalHandler(true)>

<table>
    <thead>
        <tr>
            <th>Item</th>
            <th>Quantity</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td>{{ item.name }}</td>
            <td>{{ item.quantity }}</td>
            <td>
                <a href="{% url 'subscription_box:get_item' item.id %}">Edit</a>
                <a href="{% url 'subscription_box:item_delete' item.id %}">Delete</a>
            </td>
        </tr>
        {% endfor %}
</table>

<a href="{% url 'subscription_box:item_create' %}">Create New Item</a>

{% endblock content %}

{% block scripts %}

<script>
    async function deleteItem(itemId) {
        const response = await fetch(`/subscription_box/item/delete/${itemId}/`, {
            method: 'DELETE',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            }
        });

        if (response.ok) {
            window.location.reload();
        }
    }

    async function deleteSubscriptionBox(subscriptionBoxId) {
        const response = await fetch(`/subscription-box/delete/${subscriptionBoxId}/`, {
            method: 'DELETE',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            }
        });

        if (response.ok) {
            window.location.reload();
        }
    }

    async function refreshBox() {
        const response = await fetch('/subscription-box/viewAll', {
            method: 'GET',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            }
        });
    }

    async function refreshItem() {
        const response = await fetch('/subscription-box/item/viewAll', {
            method: 'GET',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            }
        });
    }

    function createSubscription() {
        const form = document.getElementById('request-form-1');
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        fetch('/subscription-box/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify(data)
        }).then(response => {
            if (response.ok) {
                window.location.reload();
            }
        });
    }

    function createItem() {
        const form = document.getElementById('request-form-2');
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        fetch('/subscription-box/item/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify(data)
        }).then(response => {
            if (response.ok) {
                window.location.reload();
            }
        });
    }

    window.onload = function(){
        refreshBox();
        refreshItem();
    }
</script>
<script>

    let modal = document.getElementById("modal");
    function modalHandler(val) {
        if (val) {
            fadeIn(modal);
        } else {
            fadeOut(modal);
        }
    }
    function fadeOut(el) {
        el.style.opacity = 1;
        (function fade() {
            if ((el.style.opacity -= 0.1) < 0) {
                el.style.display = "none";
            } else {
                requestAnimationFrame(fade);
            }
        })();
    }
    function fadeIn(el, display) {
        el.style.opacity = 0;
        el.style.display = display || "flex";
        (function fade() {
            let val = parseFloat(el.style.opacity);
            if (!((val += 0.2) > 1)) {
                el.style.opacity = val;
                requestAnimationFrame(fade);
            }
        })();
    }
</script>
{% endblock scripts %}